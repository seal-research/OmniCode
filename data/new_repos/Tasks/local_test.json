{"repo": "Textualize/rich", "pull_number": 3296, "instance_id": "Textualize__rich-3296", "issue_numbers": ["3295"], "base_commit": "fde5d6eee3b0437eaecdcbf6f8b11aeab3a5d503", "patch": "diff --git a/CHANGELOG.md b/CHANGELOG.md\nindex e153073c2..9eff3e39f 100644\n--- a/CHANGELOG.md\n+++ b/CHANGELOG.md\n@@ -5,7 +5,6 @@ All notable changes to this project will be documented in this file.\n The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),\n and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).\n \n-\n ## Unreleased\n \n ### Fixed\n@@ -16,6 +15,7 @@ and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0\n - Thread used in progress.track will exit if an exception occurs in a generator https://github.com/Textualize/rich/pull/3402\n - Progress track thread is now a daemon thread https://github.com/Textualize/rich/pull/3402\n - Fixed cached hash preservation upon clearing meta and links https://github.com/Textualize/rich/issues/2942\n+- Fixed overriding the `background_color` of `Syntax` not including padding https://github.com/Textualize/rich/issues/3295\n \n ### Changed\n \n@@ -31,6 +31,7 @@ and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0\n \n ## [13.7.1] - 2024-02-28\n \n+\n ### Fixed\n \n - Updated the widths of some characters https://github.com/Textualize/rich/pull/3289\ndiff --git a/CONTRIBUTORS.md b/CONTRIBUTORS.md\nindex b107adc83..0ce5307ab 100644\n--- a/CONTRIBUTORS.md\n+++ b/CONTRIBUTORS.md\n@@ -20,6 +20,7 @@ The following people have contributed to the development of Rich:\n - [Aryaz Eghbali](https://github.com/AryazE)\n - [Oleksis Fraga](https://github.com/oleksis)\n - [Andy Gimblett](https://github.com/gimbo)\n+- [Tom Gooding](https://github.com/TomJGooding)\n - [Micha\u0142 G\u00f3rny](https://github.com/mgorny)\n - [Nok Lam Chan](https://github.com/noklam)\n - [Leron Gray](https://github.com/daddycocoaman)\ndiff --git a/rich/syntax.py b/rich/syntax.py\nindex f3ceff758..4da6c3b7a 100644\n--- a/rich/syntax.py\n+++ b/rich/syntax.py\n@@ -619,9 +619,7 @@ def __rich_console__(\n     ) -> RenderResult:\n         segments = Segments(self._get_syntax(console, options))\n         if self.padding:\n-            yield Padding(\n-                segments, style=self._theme.get_background_style(), pad=self.padding\n-            )\n+            yield Padding(segments, style=self._get_base_style(), pad=self.padding)\n         else:\n             yield segments\n \n", "test_patch": "diff --git a/tests/test_syntax.py b/tests/test_syntax.py\nindex 37cc293eb..bbd4c7a5c 100644\n--- a/tests/test_syntax.py\n+++ b/tests/test_syntax.py\n@@ -406,6 +406,23 @@ def test_syntax_measure():\n     assert code.__rich_measure__(console, console.options) == Measurement(3, 24)\n \n \n+def test_background_color_override_includes_padding():\n+    \"\"\"Regression test for https://github.com/Textualize/rich/issues/3295\"\"\"\n+\n+    syntax = Syntax(\n+        \"x = 1\",\n+        lexer=\"python\",\n+        padding=(1, 3),\n+        background_color=\"red\",\n+    )\n+    result = render(syntax)\n+    print(repr(result))\n+    assert (\n+        result\n+        == \"\\x1b[41m                                                                                                    \\x1b[0m\\n\\x1b[41m   \\x1b[0m\\x1b[38;2;248;248;242;41mx\\x1b[0m\\x1b[38;2;248;248;242;41m \\x1b[0m\\x1b[38;2;255;70;137;41m=\\x1b[0m\\x1b[38;2;248;248;242;41m \\x1b[0m\\x1b[38;2;174;129;255;41m1\\x1b[0m\\x1b[41m                                                                                         \\x1b[0m\\x1b[41m   \\x1b[0m\\n\\x1b[41m                                                                                                    \\x1b[0m\\n\"\n+    )\n+\n+\n if __name__ == \"__main__\":\n     syntax = Panel.fit(\n         Syntax(\n", "problem_statement": "[BUG] Overriding `background_color` of `Syntax` doesn't include padding\n- [x] I've checked [docs](https://rich.readthedocs.io/en/latest/introduction.html) and [closed issues](https://github.com/Textualize/rich/issues?q=is%3Aissue+is%3Aclosed) for possible solutions.\r\n- [x] I can't find my issue in the [FAQ](https://github.com/Textualize/rich/blob/master/FAQ.md).\r\n\r\n**Describe the bug**\r\n\r\nSee https://github.com/Textualize/textual/discussions/4227#discussioncomment-8634837 for context.\r\n\r\nAccording to the [Syntax documentation](https://rich.readthedocs.io/en/stable/syntax.html#background-color):\r\n\r\n> You can override the background color from the theme by supplying a background_color argument to the constructor.\r\n\r\nHowever this doesn't seem to work as expected if the `Syntax` has padding:\r\n\r\n![image](https://github.com/Textualize/rich/assets/101601846/65b375da-a8ca-4f6d-b208-4f2435f713f8)\r\n\r\n```python\r\nfrom rich.console import Console\r\nfrom rich.syntax import Syntax\r\n\r\ncode = \"\"\"\\\r\ndef do_something():\r\n    pass\\\r\n\"\"\"\r\n\r\nconsole = Console()\r\n\r\nsyntax = Syntax(\r\n    code,\r\n    lexer=\"python\",\r\n    word_wrap=False,\r\n    indent_guides=True,\r\n    padding=(1, 2),\r\n    theme=\"material\",\r\n    background_color=\"red\",\r\n)\r\n\r\nconsole.print(syntax)\r\n```\r\n\r\nIf you set the `background_color` to the special value \"default\", this produces a different unexpected result:\r\n\r\n![image](https://github.com/Textualize/rich/assets/101601846/9a21cdf2-3617-4cb8-9e60-1891a8b7a67a)\r\n\r\n**Platform**\r\n\r\nPlatform is Linux and tested in various terminal emulators.\r\n\r\n```console\r\n$ pip freeze | grep rich\r\nrich==13.6.0\r\n```\n", "hints_text": "Thank you for your issue. Give us a little time to review it.\n\nPS. You might want to check the [FAQ](https://github.com/textualize/rich/blob/master/FAQ.md) if you haven't done so already.\n\nThis is an automated reply, generated by [FAQtory](https://github.com/willmcgugan/faqtory)", "created_at": "2024-02-29T20:41:42Z"}
