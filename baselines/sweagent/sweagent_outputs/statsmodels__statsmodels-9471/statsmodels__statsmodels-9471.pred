{"model_name_or_path": "sweagent_outputs", "instance_id": "statsmodels__statsmodels-9471", "model_patch": "diff --git a/reproduce_error.py b/reproduce_error.py\nnew file mode 100644\nindex 0000000..6bf35cf\n--- /dev/null\n+++ b/reproduce_error.py\n@@ -0,0 +1,21 @@\n+import pandas as pd\n+import statsmodels.formula.api as smf\n+\n+data = pd.DataFrame([\n+    {\"y\": 2, \"x\": 2},\n+    {\"y\": 2, \"x\": 4},\n+    {\"y\": 4, \"x\": 6},\n+    {\"y\": 4, \"x\": 8},\n+])\n+\n+# Works\n+smf.phreg(\"y ~ x\", data=data).fit()\n+\n+def plus_one(x):\n+    return x + 1\n+\n+# Works\n+smf.ols(\"y ~ plus_one(x)\", data=data).fit()\n+\n+# PatsyError from NameError: name 'plus_one' is not defined\n+smf.phreg(\"y ~ plus_one(x)\", data=data).fit()\ndiff --git a/statsmodels/base/model.py b/statsmodels/base/model.py\nindex b1e5c2a..91e0b3b 100644\n--- a/statsmodels/base/model.py\n+++ b/statsmodels/base/model.py\n@@ -2887,3 +2887,18 @@ class GenericLikelihoodModelResults(LikelihoodModelResults, ResultMixin):\n                               use_t=self.use_t)\n \n         return smry\n+import inspect\n+\n+def fix_from_formula(from_formula_method):\n+    \"\"\"\n+    A decorator that fixes the  method to correctly capture the calling environment.\n+    \"\"\"\n+    import inspect\n+\n+    def wrapper(*args, **kwargs):\n+        eval_env = kwargs.pop('eval_env', inspect.currentframe().f_back.f_locals)\n+        kwargs['eval_env'] = eval_env\n+        return from_formula_method(*args, **kwargs)\n+\n+    wrapper.__doc__ = from_formula_method.__doc__\n+    return wrapper\n"}